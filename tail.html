<!doctype html>
<html>
	<head>
		<style type="text/css">
			body {
				text-align: left;
				font-family: monospace;
				font-size: 13px;
				position: absolute;
				top: 0;
				bottom: 0;
				right: 0;
				left: 0;
				overflow-y: scroll;
			}

			.line {
				padding-left: 50px;
				text-indent: -50px;
				white-space: pre;
			}
			.line.nginx {
				color: gray;
			}
			.line.fatal {
				color: red;
			}
			.multiple {
				margin-bottom: 5px;
			}

			#autoscroll {
				position: fixed;
				top: 5px;
				right: 5px;
			}
		</style>

		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
		<script src="/socket.io/socket.io.js"></script>
		<script>
			$(document).ready(function() {
				var $body = $('body');
				var autoscroll = true;
				var socket = io.connect('//');

				socket.on('msg', function (message) {
					var $div = $('<div class="line">' + message.data + '</div>');

					if (message.data.indexOf('nginx') != -1) {
						$div.addClass('nginx');
						if (message.data.indexOf(' 500 ') != -1) {
							$div.addClass('fatal');
						}
					} else if (message.data.indexOf('PHP Fatal error') != -1) {
						$div.addClass('fatal');
					} else if (message.data.indexOf('xception') != -1 ) {
						$div.addClass('fatal');
					}
					if (message.data.indexOf('\n') != -1 ) {
						$div.addClass('multiple');
					}

					$body.append($div);

					if (autoscroll) {
						window.scroll(0, document.height);
					}
				});

				$('#autoscroll').toggle(function() {
					autoscroll = false;
				}, function() {
					autoscroll = true;
				});
			});
	</script>
	</head>

	<body>
		<button id="autoscroll">Toggle autoscroll</button>
		<div id="log">
		</div>
	</body>
</html>
